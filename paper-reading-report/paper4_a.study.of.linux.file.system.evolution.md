#linux文件系统演变的研究
##题目
	A Study of Linux File System Evolution
##研究的问题及研究背景
	问题
    	重要的Linux开源文件系统的代码库很难读懂，文件系统的位置、漏洞的类型特点、性能特点、被最常利用的可靠性特征等信息都不为人所知，开发者和工具制造商也不能很好地设计更好的系统和使自己的工具更加贴近实际。
    背景
    	开源文件系统的重要性
            Linux Ext4、XFS和Btrfs等开源的文件系统仍然是世界上现代存储的主要组成部分
            智能手机上的许多用户数据由本地文件系统来管理
            绝大多数桌面用户没有对数据进行备份的习惯，因此本地文件系统在管理用户数据上作用很关键
		随着技术发展，我们期望能开发出更好更新的文件系统
        了解以往文件系统的发展进程有助于我们对症下药
        bug补丁的分析占了大部分的研究，其中性能和可靠性的补丁是很普遍的
        文件补丁中有一个带有注释的数据集
        Linux文件系统中存在一个非常明显的潜在相似性，可以利用这种共性改进下一代文件系统和工具
##研究方法论
###研究材料（文件系统）的选择
	综合考虑了可靠性、不同数据结构、多种性能优化、多样的先进特性、完善性等，选择了六种文件系统以及相关的模式：Ext3-JBD、Ext4-IBD2、XFS、Btrfs、ReiserFS和JFS
###文件系统补丁分类
	分类的标准要从我们的目的出发，因此确定了以下三个参考依据，按照这些问题进行补丁的分类：
        1、综述：文件系统中最多的补丁类型是什么？文件系统演变时补丁如何变化？不同类型的不定是否大小不同？
        2.Bugs：文件系统重存在什么类型的bug？包含哪些成分的文件系统存在的bug更多？不同的bug产生的不同结果是什么？
        3.性能和可靠性：文件系统为了提高其性能采用什么技术？哪些可靠性增加功能被计划加入到文件系统中？
    在后面几节会分别从这几个方面阐述
	文章中从Linux2.6文件系统中检测了5079个补丁，根据补丁中头文件和类型体中的信息将其分类
##补丁综述
###补丁类型的划分
	分为五类：
    	bug修复（Bug）、性能改善（Performance）、增强可靠性（Reliability）、引入新特性（Feature）、代码维护性质（Maintenance）
        每一中补丁通常只是其中的一种。
    从文章中给出的图表中可以观察到每种补丁类型的数量和相关性，几种补丁的百分比十分相近，其中补丁的维护在几乎所有的文件系统中是比例最高的，典型的补丁维护如提高读功能，简化结构以及使用抽象的释放。这种补丁显示了维护好一个复杂开源系统的花费。由于意义不大而且较为复杂，之后不再重点研究它。
    除了维护补丁，bug补丁也有很多，占据了将近40%的补丁，即使是成熟的文件系统中bug也是很多的。有些bug是伴随着文件系统一直存在的，这种类型之后会详细讲解。
    性能和可靠性的补丁比较少
    总结：近一半的补丁是维护型的；bug补丁有很多，而且新系统或者成熟的系统都有很多；所有文件系统都为性能和可靠性进行着改善；功能补丁比例很小。
###补丁的趋势
	不同补丁类型所占比例是否会随着文件系统的使用时间增加或减少？
    补丁的百分比随着时间稳定；
    较新的文件系统会偶而出现一些偏差；
    即使是稳定的系统，补丁bug也不会消失
###补丁的大小
	文章中使用了一个补丁增加或者删除代码的行数综合来定义补丁的复杂度
    bug补丁都很小；
    复杂的文件系统包含的bug补丁很大；
    可靠性补丁和性能补丁处于中等水平；
    功能补丁很明显比别的补丁大。
##文件系统的bug
这一部分将详细研究文件系统bug来认识它们的模式和它们造成的影响。
###代码和bug的相关联系
文件系统的代码行数跟bug的相关性研究
	文件系统普遍包含相似的逻辑功能，我们将其划分为九中逻辑功能：
    	balloc、dir、extent、file、inode、trans、super、tree、other
    对比发现：
    	文件、索引和超级块组件包含一系列不成比例的补丁；
        事务代码很大而且包含的补丁成比例；
        树形结构不容易出错使用起来也不需要太过于担心。
###bug模式
理解典型的bug类型意义很大，因为不同的类型的bug要求不同的检测和修补
	根据其产生的原因，文件系统的bug可以分为四中类型：
    	Error Code、Memory、Concurrency、Semantic
    在图表2（b）中可以看出这四种bug对应的比例，可以得出以下结论：
    	除了维护，补丁修复也是非常常见的补丁类型；
        超过一般的文件系统bug是语义bug，找到并修复之需要专业知识；
        文件系统的并发性bug所占的比例远大于用户层软件的bug；
        内存bug和错误代码bug在增加但是比例很小。
###bug趋势
文件系统的bug模式会不会随着时间改变？如果改变会变成什么样？
	研究发现：
    	bug模式随时间的变化不明显，增加和降低都是循环的；
        偏差较大是由于主要数据结构改变引起的。
###bug的影响
按照影响划分bug：数据损坏、系统崩溃、无法预料的错误、死锁、系统挂起、资源泄漏
	对应关系：
    	语义性bug：所有的影响
        并发性：死锁、数据损坏、悬挂
        内存：内存泄露、崩溃
        错误代码bug引起的影响较小
###bug模式举例和分析
语义bug：
	错误的状态修改和逻辑错误占了语义bug的大部分；
    配置错误也很常见；
    错误的I/O很少但是后果很严重；
    这类bug需要专业知识才能明白。
并发性错误
内存bug：
	资源泄露占主导地位；
    空指针简介引用也很普遍；
    故障路径是其产生的主要途径；
    多数此类bug都比较容易修复。
错误代码bug：
	发生在缺少错误处理和错误的错误处理下；
    容易修复。
###故障路径
	所有文件系统中大部分bug产生于不正确的操作因其的错误和故障；
    内存相关性错误在这些很少执行上午代码路径中很普遍；
    四分之一的语义bug都实在故障路径中发现的。
##性能和可靠性
###性能补丁
性能补丁是为了改善现有的设计和实现，将其划分为六部分：
	Synchronization、Access Optimization、Schedule、Scalability、Locality、Other
	
    同步性的性能补丁占了总性能补丁的四分之一；
    存取不定时用了缓冲和避免工作策略来优化性能；
    进程调度补丁提高了I/O的调度时间如批处理的写人，预读取进高速缓冲避免了I/O不同步问题。
###可靠性补丁
提高误差传播，提供了更多的调试信息。
	可靠性补丁会使文件系统更加稳固；
    大多数补丁添加了简单地检测，防止数据从磁盘读取出来出现坏损，通过返回崩溃性错误改善可用性；
    在编译阶段注释可以帮助找到错误；
    调试补丁增加了特征信息；
    可靠性补丁的使用在整个文件系统中非常常见。
##总结
	本文进行了一项复杂的研究，研究了六大Linux文件系统的5079个补丁；
    我们分析大量的bug数据（1800个bug）。
    这些发现可以被开发者使用，认真学习这些结论可以帮助我们开发出更加健壮，可靠和高性能的文件系统。
